# Брифинг для второго ИИ: причина некорректного отображения цены `от 8,7 млн ₽` на карточке Philips Access CT

## 1) Цель задачи

Нужно убрать некорректное серое текстовое отображение цены (`от 8,7 млн ₽`) и добиться корректного поведения:

- цена должна быть бейджем на изображении товара;
- бейдж цены должен располагаться чуть ниже зеленой плашки `В наличии`;
- целевая карточка: `Philips Access CT — КТ аппарат` (блок «Специальное предложение» на главной).

## 2) Мини-архитектура (что важно)

Проект: WordPress + WooCommerce + тема Flatsome.  
Кастомная логика карточек находится в `functions-new.php` (этот файл деплоится как серверный `functions.php` темы).

Поток рендера цены:

1. PHP-фильтр `flatsome_product_labels` добавляет HTML цены:
   - `<span class="tdp-price-badge">от ... ₽</span>`
2. Flatsome рендерит это внутри `div.badge-container` карточки.
3. CSS из `wp_head` в `functions-new.php` должен стилизовать и позиционировать `.tdp-price-badge`.

## 3) Доказанная корневая причина

Причина бага была в несовпадении CSS-селектора и реальной HTML-структуры карточки.

Что было:

- селектор: `.product-small .badge-container .tdp-price-badge`

Что реально в HTML:

- `div.badge-container` идет как соседний элемент перед `div.product-small`, а не внутри него.

Следствие:

- стиль для `.tdp-price-badge` не применялся;
- элемент отображался как обычный текст (серый, без фоновой плашки и без правильного позиционирования).

## 4) Текущее целевое решение

Селектор должен попадать в фактический DOM карточек списка, например:

- `.blog-wrapper .badge-container .tdp-price-badge`
- `.products .badge-container .tdp-price-badge`

И позиция по вертикали должна быть чуть ниже `В наличии` (например `top: 46px`).

## 5) Как связаны ключевые файлы

- `/Users/victorkornilov/WORK/tdpuls-wordpress/functions-new.php`
  - источник рендера бейджа цены (`flatsome_product_labels`);
  - источник CSS-позиционирования/стилей бейджа (`add_action('wp_head', ...)`);
  - основной файл для чтения и правок.

- `/Users/victorkornilov/WORK/tdpuls-wordpress/README.md`
  - подтверждает мэппинг деплоя: `functions-new.php` -> серверный `wp-content/themes/flatsome/functions.php`;
  - нужен, чтобы правильно применить изменения в прод.

## 6) Что проверить после правок

1. На главной в «Специальное предложение» у `Philips Access CT` цена отображается как цветной бейдж на изображении.
2. Бейдж цены расположен ниже зеленой плашки `В наличии`.
3. Нет серого текстового `от 8,7 млн ₽` над карточкой.
4. Другие карточки и single product не сломаны визуально.
